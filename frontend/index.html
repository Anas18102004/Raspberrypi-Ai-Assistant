#!/usr/bin/env python3
import RPi.GPIO as GPIO
import time

# Direction pins
IN1 = 17  # Left forward
IN2 = 18  # Left backward
IN3 = 22  # Right forward
IN4 = 23  # Right backward

# Enable pins (PWM)
ENA = 27  # Left enable
ENB = 24  # Right enable

GPIO.setmode(GPIO.BCM)
GPIO.setwarnings(False)

for pin in (IN1, IN2, IN3, IN4, ENA, ENB):
    GPIO.setup(pin, GPIO.OUT)

# Create PWM objects at 1000 Hz
pwm_left = GPIO.PWM(ENA, 1000)
pwm_right = GPIO.PWM(ENB, 1000)

pwm_left.start(0)   # 0% duty initially
pwm_right.start(0)

def set_speed(left_speed=100, right_speed=100):
    """Set speed 0ï¿½100% for left and right motors."""
    pwm_left.ChangeDutyCycle(left_speed)
    pwm_right.ChangeDutyCycle(right_speed)

def stop():
    GPIO.output(IN1, 0); GPIO.output(IN2, 0)
    GPIO.output(IN3, 0); GPIO.output(IN4, 0)
    set_speed(0, 0)

def forward(t=2, speed=80):
    set_speed(speed, speed)
    GPIO.output(IN1, 1); GPIO.output(IN2, 0)
    GPIO.output(IN3, 1); GPIO.output(IN4, 0)
    time.sleep(t); stop()

def backward(t=2, speed=80):
    set_speed(speed, speed)
    GPIO.output(IN1, 0); GPIO.output(IN2, 1)
    GPIO.output(IN3, 0); GPIO.output(IN4, 1)
    time.sleep(t); stop()

def left(t=1, speed=80):
    # Left motors backward, right motors forward
    set_speed(speed, speed)
    GPIO.output(IN1, 0); GPIO.output(IN2, 1)
    GPIO.output(IN3, 1); GPIO.output(IN4, 0)
    time.sleep(t); stop()

def right(t=1, speed=80):
    # Left motors forward, right motors backward
    set_speed(speed, speed)
    GPIO.output(IN1, 1); GPIO.output(IN2, 0)
    GPIO.output(IN3, 0); GPIO.output(IN4, 1)
    time.sleep(t); stop()

if __name__ == "__main__":
    try:
        print("Forward")
        forward(2, 80)
        time.sleep(1)

        print("Backward")
        backward(2, 80)
        time.sleep(1)

        print("Left")
        left(1, 80)
        time.sleep(1)

        print("Right")
        right(1, 80)
        time.sleep(1)

    finally:
        stop()
        pwm_left.stop()
        pwm_right.stop()
        GPIO.cleanup()
        print("GPIO cleaned up.")
